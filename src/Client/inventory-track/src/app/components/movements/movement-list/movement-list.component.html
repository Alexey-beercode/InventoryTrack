<app-header
  title="–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏—è"
  (userEmitter)="onUserReceived($event)"
  (companyIdEmitter)="onCompanyIdReceived($event)">
</app-header>


<div class="container">
  <h2>–°–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π</h2>

  <app-error-message *ngIf="errorMessage" [message]="errorMessage"></app-error-message>

  <div *ngIf="isLoading" class="loading-container">
    <app-loading-spinner></app-loading-spinner>
  </div>

  <div *ngIf="!isLoading && movements.length > 0" class="table">
    <div class="table-header">
      <div>–¢–æ–≤–∞—Ä</div>
      <div>–°–æ —Å–∫–ª–∞–¥–∞</div>
      <div>–ù–∞ —Å–∫–ª–∞–¥</div>
      <div>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</div>
      <div>–°—Ç–∞—Ç—É—Å</div>
      <div>–î–µ–π—Å—Ç–≤–∏—è</div>
    </div>
    <div *ngFor="let movement of movements" class="table-row">
      <div>{{ getItemName(movement.itemId) }}</div>
      <div>{{ getWarehouseName(movement.sourceWarehouseId) }}</div>
      <div>{{ getWarehouseName(movement.destinationWarehouseId) }}</div>
      <div>{{ movement.quantity }}</div>
      <div>{{ movement.status.name }}</div>
      <div>
        <div  class="actions">
          <button *ngIf="movement.status.value === MovementRequestStatus.Completed && isAccountant && movement.status.name === '–û–¥–æ–±—Ä–µ–Ω–æ'"
                  class="approve-btn"
                  (click)="openUploadModal(movement.id)">üìÑ –£—Ç–≤–µ—Ä–¥–∏—Ç—å</button>

          <button *ngIf="movement.status.value === MovementRequestStatus.Completed && isAccountant && movement.status.name === '–û–¥–æ–±—Ä–µ–Ω–æ'"
                  class="reject-btn"
                  (click)="rejectMovement(movement.id)">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>

          <button *ngIf="movement.status.value === MovementRequestStatus.Processing && !isAccountant"
                  class="approve-btn"
                  (click)="approveMovement(movement.id)">
            –û–¥–æ–±—Ä–∏—Ç—å
          </button>

          <button *ngIf="movement.status.value === MovementRequestStatus.Processing && !isAccountant"
                  class="reject-btn"
                  (click)="rejectMovement(movement.id)">
            –û—Ç–∫–ª–æ–Ω–∏—Ç—å
          </button>
        </div>

        <!-- üìé –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è Excel -->
        <div *ngIf="movement.documentId && movement.documentId !== '00000000-0000-0000-0000-000000000000'" class="download-section">
          <button class="download-btn" (click)="downloadDocument(movement.documentId)">
            üì• –°–∫–∞—á–∞—Ç—å Excel
          </button>
        </div>
      </div>
    </div>

  </div>
  <div *ngIf="showUploadModal" class="upload-modal">
    <div class="upload-modal-content" style="max-width: 600px;">
      <h3>üìé –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞</h3>

      <input type="file" (change)="onFileSelected($event)" />

      <div *ngIf="isDocumentGenerated" class="generated-info">
        <p>‚úÖ –î–æ–∫—É–º–µ–Ω—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
        <span class="file-icon">üìÑ</span>
      </div>

      <div *ngIf="!isDocumentGenerated" class="generate-wrapper">
        <button class="btn generate-btn" (click)="generateDocument()" [disabled]="isGeneratingDocument">
          {{ isGeneratingDocument ? '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...' : '–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç' }}
        </button>
      </div>

      <div class="actions">
        <button class="final-approve-btn" (click)="confirmUpload()" [disabled]="!selectedFile && !generatedDocumentFile">
          –£—Ç–≤–µ—Ä–¥–∏—Ç—å
        </button>
        <button class="btn-secondary" (click)="resetModal()">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>

  <div *ngIf="!isLoading && movements.length === 0" class="no-data">
    <p>–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.</p>
  </div>
</div>

<app-footer></app-footer>
