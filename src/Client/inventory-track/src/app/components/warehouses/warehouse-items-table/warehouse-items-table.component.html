<app-header title="–°–∫–ª–∞–¥: {{ warehouseState?.name || '–ó–∞–≥—Ä—É–∑–∫–∞...' }}"></app-header>

<div class="container">
  <app-back-button></app-back-button>

  <!-- –û—à–∏–±–∫–∞ -->
  <app-error-message *ngIf="errorMessage" [message]="errorMessage"></app-error-message>

  <!-- –°–ø–∏–Ω–Ω–µ—Ä -->
  <div *ngIf="isLoading" class="loading-container">
    <app-loading-spinner></app-loading-spinner>
  </div>

  <!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
  <div *ngIf="!isLoading && inventoryItems.length > 0" class="filter-panel">
    <div class="filter-row">
      <input type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –ø–æ—Å—Ç–∞–≤—â–∏–∫—É –∏–ª–∏ –ø–∞—Ä—Ç–∏–∏" [(ngModel)]="filter.search" />

      <input type="text" placeholder="–ù–æ–º–µ—Ä –ø–∞—Ä—Ç–∏–∏" [(ngModel)]="filter.batchNumber" />

      <select [(ngModel)]="filter.measureUnit">
        <option value="">–í—Å–µ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è</option>
        <option *ngFor="let unit of getUniqueMeasureUnits()" [value]="unit">{{ unit }}</option>
      </select>
    </div>

    <div class="filter-row">
      <input type="number" placeholder="–¶–µ–Ω–∞ –æ—Ç" [(ngModel)]="filter.priceMin" />
      <input type="number" placeholder="–¶–µ–Ω–∞ –¥–æ" [(ngModel)]="filter.priceMax" />

      <input type="number" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç" [(ngModel)]="filter.quantityMin" />
      <input type="number" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ" [(ngModel)]="filter.quantityMax" />

      <select [(ngModel)]="filter.sortBy">
        <option value="">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ...</option>
        <option value="priceAsc">–¶–µ–Ω–∞ ‚Üë</option>
        <option value="priceDesc">–¶–µ–Ω–∞ ‚Üì</option>
        <option value="quantityAsc">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ ‚Üë</option>
        <option value="quantityDesc">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ ‚Üì</option>
        <option value="batchAsc">–ü–∞—Ä—Ç–∏—è ‚Üë</option>
        <option value="batchDesc">–ü–∞—Ä—Ç–∏—è ‚Üì</option>
      </select>
    </div>

    <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ -->
    <div class="view-controls">
      <button class="btn-toggle" (click)="toggleAdvancedView()">
        {{ showAdvancedColumns ? 'üìã –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–∏–¥' : 'üìä –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –≤–∏–¥' }}
      </button>
    </div>
  </div>

  <!-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
  <div *ngIf="!isLoading && inventoryItems.length > 0" class="items-table">
    <h3>–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ ({{ getFilteredItemsCount() }})</h3>

    <div class="table-container">
      <table class="styled-table">
        <thead>
        <tr>
          <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
          <th>–ö–æ–¥</th>
          <th>–ü–∞—Ä—Ç–∏—è</th>
          <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
          <th>–ï–¥. –∏–∑–º.</th>
          <th>–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
          <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
          <th>–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏</th>
          <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ -->
          <th *ngIf="showAdvancedColumns">–ù–î–° %</th>
          <th *ngIf="showAdvancedColumns">–ì—Ä—É–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞</th>
          <th *ngIf="showAdvancedColumns">–ú–∞—Å—Å–∞ (–∫–≥)</th>
          <th *ngIf="showAdvancedColumns">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let item of getFilteredItems()"
            [class.batch-highlight]="item.batchNumber">
          <td>
            <div class="item-name">{{ item.name }}</div>
          </td>
          <td>{{ item.uniqueCode }}</td>
          <td>
            <span *ngIf="item.batchNumber" class="batch-number">
              üì¶ {{ item.batchNumber }}
            </span>
            <span *ngIf="!item.batchNumber" class="no-batch">
              ‚ûñ –ë–µ–∑ –ø–∞—Ä—Ç–∏–∏
            </span>
          </td>
          <td>
            <span class="quantity">{{ item.quantity }}</span>
          </td>
          <td>{{ item.measureUnit }}</td>
          <td>{{ item.supplier }}</td>
          <td>
            <span class="price">{{ item.estimatedValue | number:'1.2-2' }} –±–µ–ª. —Ä—É–±.</span>
          </td>
          <td>
            <span class="expiration-date"
                  [class.expiring-soon]="isExpiringSoon(item.expirationDate)">
              {{ item.expirationDate | date: 'dd.MM.yyyy' }}
            </span>
          </td>
          <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ -->
          <td *ngIf="showAdvancedColumns">
            {{ getVatRateDisplay(item.vatRate) }}
          </td>
          <td *ngIf="showAdvancedColumns">
            {{ getPlacesCountDisplay(item.placesCount) }}
          </td>
          <td *ngIf="showAdvancedColumns">
            {{ getCargoWeightDisplay(item.cargoWeight) }}
          </td>
          <td *ngIf="showAdvancedColumns" class="notes-column">
            <span *ngIf="item.notes" [title]="item.notes">
              {{ getTruncatedNotes(item.notes) }}
            </span>
            <span *ngIf="!item.notes">‚Äî</span>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <!-- –°–≤–æ–¥–∫–∞ –ø–æ –ø–∞—Ä—Ç–∏—è–º -->
    <div class="batch-summary" *ngIf="shouldShowBatchSummary()">
      <h4>üì¶ –°–≤–æ–¥–∫–∞ –ø–æ –ø–∞—Ä—Ç–∏—è–º</h4>
      <div class="batch-cards">
        <div *ngFor="let batch of getBatchSummaryData()" class="batch-card">
          <div class="batch-header">
            <strong>{{ batch.batchNumber }}</strong>
          </div>
          <div class="batch-info">
            <span>–¢–æ–≤–∞—Ä–æ–≤: {{ batch.itemsCount }}</span>
            <span>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: {{ batch.totalQuantity }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<app-footer></app-footer>
