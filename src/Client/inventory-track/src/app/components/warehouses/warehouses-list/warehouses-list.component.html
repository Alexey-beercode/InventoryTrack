<app-header
  title="–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∫–ª–∞–¥–æ–≤"
  (companyIdEmitter)="onCompanyIdReceived($event)"
  (userEmitter)="onUserReceived($event)"
></app-header>

<div *ngIf="companyId">
  <div class="warehouse-states-container">
    <div class="warehouse-states-header">
      <button class="add-warehouse-button" (click)="openCreateModal()">–î–æ–±–∞–≤–∏—Ç—å —Å–∫–ª–∞–¥</button>
    </div>

    <div class="warehouse-states-content">
      <div *ngIf="isLoading" class="loading-container">
        <app-loading-spinner></app-loading-spinner>
      </div>

      <div *ngIf="!isLoading && warehouseStates.length === 0" class="no-warehouses">
        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é —Å–∫–ª–∞–¥–æ–≤.</p>
      </div>

      <div *ngIf="!isLoading && warehouseStates.length > 0" class="warehouse-states-list">
        <div *ngFor="let state of warehouseStates" class="warehouse-card">
          <h3>{{ state.name }}</h3>
          <p><strong>–¢–∏–ø:</strong> {{ state.type.name }}</p>
          <p><strong>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</strong> {{ state.location }}</p>
          <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã—Ö —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π:</strong> {{ state.itemsCount }}</p>
          <p><strong>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:</strong> {{ state.quantity }}</p>

          <p *ngIf="!state.responsiblePersonId || state.responsiblePersonId === userId" class="no-manager">
            üö® <i>–°–∫–ª–∞–¥—É –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω –Ω–∞—á–∞–ª—å–Ω–∏–∫</i>
          </p>

          <div class="warehouse-card-buttons">
            <button class="details-button" [routerLink]="['/warehouse', state.id]">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
            <button *ngIf="!state.responsiblePersonId || state.responsiblePersonId === userId"
                    class="assign-button"
                    (click)="assignManager(state.id, state.type.name)">
              –ù–∞–∑–Ω–∞—á–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞
            </button>

            <button class="delete-button" (click)="openDeleteConfirmModal(state.id, state.name)">–£–¥–∞–ª–∏—Ç—å</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
<div *ngIf="showDeleteConfirmModal" class="modal-overlay">
  <div class="modal">
    <h2>–£–¥–∞–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥–∞</h2>
    <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–∫–ª–∞–¥ <b>{{ selectedWarehouseName }}</b>?</p>
    <div class="modal-actions">
      <button (click)="deleteWarehouse()" class="save-button">–£–¥–∞–ª–∏—Ç—å</button>
      <button (click)="showDeleteConfirmModal = false" class="cancel-button">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

<!-- üìå –ú–æ–¥–∞–ª–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞ -->
<div *ngIf="showAssignManagerModal" class="modal-overlay">
  <div class="modal">
    <h2>–í—ã–±–æ—Ä –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞ —Å–∫–ª–∞–¥–∞</h2>

    <div class="form-group" *ngIf="errorMessage">
      <p class="error-message">{{ errorMessage }}</p>
    </div>

    <div class="form-group" *ngIf="!errorMessage">
      <label for="managerSelect">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞:</label>
      <select [(ngModel)]="selectedManagerId" id="managerSelect" class="form-select">
        <option *ngFor="let user of filteredUsers" [value]="user.id">
          {{ user.firstName }} {{ user.lastName }} ({{ user.roles[0]?.name }})
        </option>
      </select>
    </div>

    <div class="modal-actions">
      <button  (click)="confirmAssignManager()" class="save-button" [disabled]="!!errorMessage">–ù–∞–∑–Ω–∞—á–∏—Ç—å</button>
      <button (click)="showAssignManagerModal = false" class="cancel-button">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

<app-create-warehouse *ngIf="showCreateModal" [companyId]="companyId" [userId]="userId" (close)="closeCreateModal()" (refreshList)="loadWarehouseStates()"></app-create-warehouse>


<app-footer></app-footer>
