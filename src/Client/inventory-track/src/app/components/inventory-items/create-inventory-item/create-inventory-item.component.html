<app-header title="–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏" (userEmitter)="onUserReceived($event!)"></app-header>

<div class="create-inventory-container">
  <app-back-button></app-back-button>

  <app-error-message *ngIf="errorMessage" [message]="errorMessage"></app-error-message>

  <form #inventoryForm="ngForm" (ngSubmit)="createInventoryItem(inventoryForm)" class="create-inventory-form" novalidate>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <fieldset class="form-section">
      <legend>üì¶ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</legend>

      <div class="form-group">
        <label for="name">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
        <input id="name" name="name" type="text" [(ngModel)]="newInventoryItem.name" required #name="ngModel" />
        <div *ngIf="name.invalid && name.touched" class="error">‚ö†Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!</div>
      </div>

      <div class="form-group">
        <label for="uniqueCode">–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ *</label>
        <input id="uniqueCode"
               name="uniqueCode"
               type="text"
               pattern="^[0-9]+$"
               [(ngModel)]="newInventoryItem.uniqueCode"
               required
               #uniqueCode="ngModel" />
        <div *ngIf="uniqueCode.invalid && uniqueCode.touched" class="error">
          ‚ö†Ô∏è –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã!
        </div>
      </div>

      <div class="form-group">
        <label for="supplierId">–ü–æ—Å—Ç–∞–≤—â–∏–∫ *</label>
        <select id="supplierId" name="supplierId" [(ngModel)]="newInventoryItem.supplierId" required>
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</option>
          <option *ngFor="let supplier of suppliers" [value]="supplier.id">{{ supplier.name }}</option>
        </select>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ *</label>
          <input id="quantity" name="quantity" type="number" min="1" [(ngModel)]="newInventoryItem.quantity" required #quantity="ngModel" />
          <div *ngIf="quantity.invalid && quantity.touched" class="error">‚ö†Ô∏è –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ 0!</div>
        </div>

        <div class="form-group">
          <label for="measureUnit">–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è</label>
          <select id="measureUnit" name="measureUnit" [(ngModel)]="newInventoryItem.measureUnit">
            <option value="—à—Ç">—à—Ç</option>
            <option value="–∫–≥">–∫–≥</option>
            <option value="–ª">–ª</option>
            <option value="–º">–º</option>
            <option value="–º¬≤">–º¬≤</option>
            <option value="–º¬≥">–º¬≥</option>
            <option value="—É–ø–∞–∫">—É–ø–∞–∫</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="estimatedValue">–û—Ü–µ–Ω–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å *</label>
        <input id="estimatedValue"
               name="estimatedValue"
               type="number"
               min="0"
               step="0.01"
               [(ngModel)]="newInventoryItem.estimatedValue"
               required
               #estimatedValue="ngModel" />
        <div *ngIf="estimatedValue.invalid && estimatedValue.touched" class="error">
          ‚ö†Ô∏è –°—Ç–æ–∏–º–æ—Å—Ç—å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π!
        </div>
      </div>
    </fieldset>

    <!-- –ü–∞—Ä—Ç–∏—è –∏ –¥–∞—Ç—ã -->
    <fieldset class="form-section">
      <legend>üìÖ –ü–∞—Ä—Ç–∏—è –∏ –¥–∞—Ç—ã</legend>

      <div class="form-group">
        <label for="batchNumber">–ù–æ–º–µ—Ä –ø–∞—Ä—Ç–∏–∏</label>
        <div class="batch-input-container">
          <input id="batchNumber"
                 name="batchNumber"
                 type="text"
                 [(ngModel)]="newInventoryItem.batchNumber"
                 placeholder="YYYY-MM-DD-XXXX" />
          <button type="button" class="btn-generate" (click)="generateBatchNumber()">üîÑ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
        <small class="form-hint">–§–æ—Ä–º–∞—Ç: YYYY-MM-DD-XXXX (–Ω–∞–ø—Ä–∏–º–µ—Ä: 2024-12-20-0001)</small>
        <div *ngIf="newInventoryItem.batchNumber && !validateBatchNumber()" class="error">
          ‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–∞ –ø–∞—Ä—Ç–∏–∏!
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="deliveryDate">–î–∞—Ç–∞ –ø–æ—Å—Ç–∞–≤–∫–∏ *</label>
          <input id="deliveryDate"
                 name="deliveryDate"
                 type="date"
                 [(ngModel)]="newInventoryItem.deliveryDate"
                 (change)="onDeliveryDateChange()"
                 required
                 #deliveryDate="ngModel" />
        </div>

        <div class="form-group">
          <label for="expirationDate">–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ *</label>
          <input id="expirationDate"
                 name="expirationDate"
                 type="date"
                 [(ngModel)]="newInventoryItem.expirationDate"
                 required
                 #expirationDate="ngModel" />
        </div>
      </div>

      <div *ngIf="showDateError" class="error">
        ‚ö†Ô∏è –î–∞—Ç—ã –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è.
      </div>
    </fieldset>

    <!-- –î–∞–Ω–Ω—ã–µ –¥–ª—è –¢–¢–ù -->
    <fieldset class="form-section">
      <legend>üöõ –î–∞–Ω–Ω—ã–µ –¥–ª—è –¢–¢–ù</legend>

      <div class="form-row">
        <div class="form-group">
          <label for="vatRate">–°—Ç–∞–≤–∫–∞ –ù–î–° (%)</label>
          <input id="vatRate"
                 name="vatRate"
                 type="number"
                 min="0"
                 max="100"
                 step="0.1"
                 [(ngModel)]="newInventoryItem.vatRate" />
        </div>

        <div class="form-group">
          <label for="placesCount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç</label>
          <input id="placesCount"
                 name="placesCount"
                 type="number"
                 min="1"
                 [(ngModel)]="newInventoryItem.placesCount" />
        </div>
      </div>

      <div class="form-group">
        <label for="cargoWeight">–ú–∞—Å—Å–∞ –≥—Ä—É–∑–∞ (–∫–≥)</label>
        <input id="cargoWeight"
               name="cargoWeight"
               type="number"
               min="0"
               step="0.01"
               [(ngModel)]="newInventoryItem.cargoWeight" />
      </div>

      <div class="form-group">
        <label for="notes">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
        <textarea id="notes"
                  name="notes"
                  rows="3"
                  [(ngModel)]="newInventoryItem.notes"
                  placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ..."></textarea>
      </div>
    </fieldset>

    <!-- –î–æ–∫—É–º–µ–Ω—Ç -->
    <fieldset class="form-section">
      <legend>üìÑ –î–æ–∫—É–º–µ–Ω—Ç</legend>

      <div class="form-group">
        <label for="documentFile">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</label>
        <input id="documentFile" name="documentFile" type="file" (change)="onFileSelected($event)" />
      </div>
    </fieldset>

    <div class="create-inventory-buttons">
      <button type="submit" class="btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button type="button" class="btn-secondary" (click)="cancel()">‚ùå –û—Ç–º–µ–Ω–∞</button>
    </div>
  </form>
</div>

<app-footer></app-footer>
